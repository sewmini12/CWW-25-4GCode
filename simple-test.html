<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkinCare AI - Simple Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #007bff;
            background: #f8f9fa;
        }
        .upload-area.dragover {
            border-color: #007bff;
            background: #e3f2fd;
        }
        input[type="file"] {
            display: none;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }
        .preview {
            max-width: 300px;
            max-height: 300px;
            margin: 10px auto;
            display: block;
            border-radius: 10px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: center;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        /* Enhanced Analysis Section Styles */
        .analysis-section {
            margin-top: 30px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .upload-area {
            position: relative;
            border: 3px dashed #cbd5e0;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .upload-area:hover {
            border-color: #007bff;
            background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #007bff;
            background: linear-gradient(135deg, #ebf8ff 0%, #90cdf4 100%);
            transform: scale(1.02);
        }

        .upload-area.has-file {
            border-color: #48bb78;
            background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
        }

        .upload-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .upload-icon {
            font-size: 4rem;
            color: #007bff;
            margin-bottom: 10px;
        }

        .upload-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .upload-subtext {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .file-info {
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .analysis-controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn.secondary {
            background: linear-gradient(135deg, #6c757d 0%, #545b62 100%);
        }

        .btn.danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn.success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }

        /* Enhanced Result Section */
        .result {
            margin-top: 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            display: none;
        }

        .result-header {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .result-timestamp {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .result-content {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 25px;
            padding: 25px;
        }

        .image-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 15px;
        }

        .image-info {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            color: #6c757d;
            text-align: center;
            width: 100%;
        }

        .analysis-details {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .condition-card {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            border: 1px solid #c3e6cb;
            border-radius: 12px;
            padding: 20px;
        }

        .condition-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .condition-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: #155724;
        }

        .confidence-badge {
            background: #28a745;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .condition-description {
            color: #155724;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .severity-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .severity-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .severity-dot.low { background: #28a745; }
        .severity-dot.medium { background: #ffc107; }
        .severity-dot.high { background: #dc3545; }

        .treatment-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 1px solid #90caf9;
            border-radius: 12px;
            padding: 20px;
        }

        .treatment-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1565c0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .treatment-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .treatment-item {
            background: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .treatment-icon {
            color: #2196f3;
            font-size: 1.1rem;
            margin-top: 2px;
        }

        .disclaimer-card {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border: 1px solid #ffcc02;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
        }

        .disclaimer-text {
            color: #e65100;
            font-size: 0.9rem;
            line-height: 1.5;
            margin: 0;
        }

        /* Analysis Progress */
        .analysis-progress {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: none;
        }

        .progress-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #e3f2fd;
            border-top: 4px solid #2196f3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-text {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 10px;
        }

        .progress-subtext {
            color: #888;
            font-size: 0.9rem;
        }

        /* Analysis History */
        .history-section {
            margin-top: 30px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .history-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .history-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .history-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .history-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .history-thumbnail {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .history-details {
            display: flex;
            flex-direction: column;
        }

        .history-condition {
            font-weight: 600;
            color: #333;
        }

        .history-date {
            font-size: 0.8rem;
            color: #666;
        }

        .history-confidence {
            font-size: 0.9rem;
            color: #007bff;
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .result-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .analysis-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                justify-content: center;
            }
            
            .result-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }

        /* Hidden elements */
        .hidden {
            display: none !important;
        }

        /* Outbreak Alerts Styles */
        .outbreak-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1200px;
            color: white;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
            display: block !important; /* Force visibility for debugging */
            min-height: 200px; /* Ensure it takes space */
        }

        .outbreak-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .outbreak-title {
            font-size: 2.5rem;
            margin: 0 0 0.5rem 0;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .outbreak-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin: 0;
        }

        .outbreak-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .control-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .location-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .location-label {
            font-weight: 600;
            white-space: nowrap;
        }

        .location-select {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            backdrop-filter: blur(10px);
            min-width: 150px;
        }

        .location-select option {
            background: #667eea;
            color: white;
        }

        .outbreak-status {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .indicator-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .indicator-dot.green {
            background: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .indicator-dot.yellow {
            background: #FF9800;
            box-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
        }

        .indicator-dot.red {
            background: #f44336;
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.5);
        }

        .indicator-dot.pulsing {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }

        .status-text {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .last-update {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .outbreak-dashboard {
            margin-bottom: 2rem;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .stat-icon {
            font-size: 2rem;
            opacity: 0.9;
        }

        .stat-content {
            flex: 1;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .outbreak-map-placeholder {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 2rem;
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .map-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }

        .map-legend {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        .legend-dot.high {
            background: #f44336;
        }

        .legend-dot.medium {
            background: #FF9800;
        }

        .legend-dot.low {
            background: #4CAF50;
        }

        .map-container {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .map-placeholder {
            opacity: 0.8;
        }

        .map-note {
            font-size: 0.9rem;
            margin-top: 0.5rem;
            opacity: 0.7;
        }

        .outbreak-alerts {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .alerts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .alerts-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }

        .alert-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .alerts-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .alert-item {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid;
            transition: transform 0.3s ease;
        }

        .alert-item:hover {
            transform: translateX(5px);
        }

        .alert-item.high {
            border-left-color: #f44336;
        }

        .alert-item.medium {
            border-left-color: #FF9800;
        }

        .alert-item.low {
            border-left-color: #4CAF50;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .alert-title {
            font-weight: 600;
            font-size: 1rem;
            margin: 0;
        }

        .alert-severity {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .alert-severity.high {
            background: rgba(244, 67, 54, 0.3);
            color: #ffcdd2;
        }

        .alert-severity.medium {
            background: rgba(255, 152, 0, 0.3);
            color: #ffe0b2;
        }

        .alert-severity.low {
            background: rgba(76, 175, 80, 0.3);
            color: #c8e6c9;
        }

        .alert-location {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .alert-description {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }

        .alert-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            opacity: 0.7;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .outbreak-insights {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .outbreak-insights h3 {
            margin: 0 0 1rem 0;
            font-size: 1.3rem;
        }

        .insights-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .insight-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 1rem;
            border-left: 3px solid #4CAF50;
        }

        .insight-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .insight-text {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.4;
        }

        .no-alerts {
            text-align: center;
            padding: 2rem;
            color: rgba(255,255,255,0.8);
            font-size: 1.1rem;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            border: 2px dashed rgba(255,255,255,0.3);
        }

        /* Notification Center Styles */
        .notification-section {
            background: linear-gradient(135deg, #ff7f50 0%, #ff6347 100%);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1200px;
            color: white;
            box-shadow: 0 15px 35px rgba(255, 127, 80, 0.3);
        }

        .notification-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .notification-title {
            font-size: 2.5rem;
            margin: 0 0 0.5rem 0;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .notification-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin: 0;
        }

        .notification-controls {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .notification-settings {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            font-weight: 500;
        }

        .setting-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .setting-label {
            font-size: 1rem;
            user-select: none;
        }

        .notification-status {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .permission-status {
            opacity: 0.8;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .notification-types {
            margin-bottom: 2rem;
        }

        .notification-types h3 {
            margin: 0 0 1.5rem 0;
            font-size: 1.5rem;
        }

        .notification-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .notification-type-card {
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .notification-type-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .notification-type-card.outbreak {
            border-left: 4px solid #f44336;
        }

        .notification-type-card.analysis {
            border-left: 4px solid #2196F3;
        }

        .notification-type-card.system {
            border-left: 4px solid #FF9800;
        }

        .notification-type-card.reminders {
            border-left: 4px solid #4CAF50;
        }

        .type-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .type-content h4 {
            margin: 0 0 0.5rem 0;
            font-size: 1.2rem;
        }

        .type-content p {
            margin: 0 0 1rem 0;
            opacity: 0.9;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .type-settings {
            margin-top: 1rem;
        }

        .priority-select {
            width: 100%;
            padding: 0.5rem;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .priority-select option {
            background: #ff7f50;
            color: white;
        }

        .notification-history {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .history-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }

        .history-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .notification-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid;
            transition: transform 0.3s ease;
        }

        .notification-item:hover {
            transform: translateX(5px);
        }

        .notification-item.outbreak {
            border-left-color: #f44336;
        }

        .notification-item.analysis {
            border-left-color: #2196F3;
        }

        .notification-item.system {
            border-left-color: #FF9800;
        }

        .notification-item.reminder {
            border-left-color: #4CAF50;
        }

        .notification-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .notification-item-title {
            font-weight: 600;
            font-size: 1rem;
            margin: 0;
        }

        .notification-time {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .notification-content {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.4;
        }

        .notification-tips {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .notification-tips h3 {
            margin: 0 0 1.5rem 0;
            font-size: 1.3rem;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .tip-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 1.5rem;
            border-left: 3px solid rgba(255,255,255,0.3);
        }

        .tip-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .tip-content h4 {
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
        }

        .tip-content p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* Health Dashboard Styles */
        .dashboard-section {
            margin: 40px 0;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .dashboard-title {
            font-size: 2.5rem;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .dashboard-subtitle {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .dashboard-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }

        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .card-icon {
            font-size: 3rem;
            opacity: 0.8;
        }

        .card-content h3 {
            font-size: 2rem;
            margin: 0 0 5px 0;
            color: #333;
        }

        .card-content p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        .progress-charts {
            padding: 30px;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .chart-container h3 {
            margin: 0 0 20px 0;
            color: #333;
        }

        .recent-activity {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .recent-activity h3 {
            margin: 0 0 20px 0;
            color: #333;
        }

        .activity-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        .activity-item:hover {
            background: #e9ecef;
        }

        /* Treatment Section Styles */
        .treatment-section {
            margin: 40px 0;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .treatment-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .treatment-title {
            font-size: 2.5rem;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .treatment-subtitle {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .treatment-plans {
            padding: 30px;
        }

        .treatment-plan {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .treatment-plan.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #f8f9ff, #fff);
        }

        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .plan-header h3 {
            margin: 0;
            color: #333;
        }

        .plan-status {
            background: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .plan-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
            transition: all 0.3s;
        }

        .plan-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .plan-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .plan-details {
            flex: 1;
        }

        .plan-details h4 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 1.1rem;
        }

        .plan-details p {
            margin: 0 0 10px 0;
            color: #666;
            line-height: 1.4;
        }

        .plan-schedule {
            font-size: 0.9rem;
            color: #667eea;
            font-weight: 500;
        }

        .plan-status-check input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .plan-progress {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 12px;
        }

        .progress-label {
            font-weight: 500;
            color: #333;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            font-weight: 500;
            color: #667eea;
        }

        .treatment-recommendations {
            margin-top: 30px;
        }

        .treatment-recommendations h3 {
            color: #333;
            margin-bottom: 20px;
        }

        .recommendation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .recommendation-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e9ecef;
            transition: all 0.3s;
        }

        .recommendation-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        /* Appointment Section Styles */
        .appointment-section {
            margin: 40px 0;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .appointment-header {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .appointment-title {
            font-size: 2.5rem;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .appointment-subtitle {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .appointment-content {
            padding: 30px;
        }

        .doctor-selection h3 {
            color: #333;
            margin-bottom: 20px;
        }

        .doctor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .doctor-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
            text-align: center;
        }

        .doctor-card:hover {
            border-color: #f093fb;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .doctor-card.selected {
            border-color: #f093fb;
            background: linear-gradient(135deg, #fff5f9, #fff);
        }

        .doctor-avatar {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .doctor-info h4 {
            margin: 0 0 5px 0;
            color: #333;
            font-size: 1.3rem;
        }

        .doctor-info p {
            margin: 0 0 10px 0;
            color: #666;
        }

        .doctor-rating {
            margin: 10px 0;
            color: #ffc107;
        }

        .doctor-experience {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
        }

        .select-doctor-btn {
            background: #f093fb;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .select-doctor-btn:hover {
            background: #e082eb;
            transform: translateY(-2px);
        }

        .appointment-booking {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .appointment-booking h3 {
            color: #333;
            margin-bottom: 25px;
        }

        .booking-form {
            display: grid;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 500;
            color: #333;
        }

        .form-control {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #f093fb;
        }

        .appointment-history {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
        }

        .appointment-history h3 {
            color: #333;
            margin-bottom: 20px;
        }

        .appointment-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .appointment-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #f093fb;
            transition: all 0.3s;
        }

        .appointment-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Education Section Styles */
        .education-section {
            margin: 40px 0;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .education-header {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            color: #333;
            padding: 30px;
            text-align: center;
        }

        .education-title {
            font-size: 2.5rem;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .education-subtitle {
            margin: 10px 0 0 0;
            opacity: 0.8;
            font-size: 1.1rem;
        }

        .education-categories {
            padding: 30px;
        }

        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 25px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            border-color: #fcb69f;
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            border-color: #fcb69f;
            color: #333;
        }

        .category-content {
            display: none;
        }

        .category-content.active {
            display: block;
        }

        .article-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .education-article {
            background: white;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e9ecef;
            transition: all 0.3s;
        }

        .education-article:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transform: translateY(-5px);
        }

        .article-image {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 20px;
        }

        .education-article h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.3rem;
        }

        .education-article p {
            margin: 0 0 20px 0;
            color: #666;
            line-height: 1.6;
        }

        .read-more-btn {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            color: #333;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            width: 100%;
        }

        .read-more-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <!-- VISIBLE TEST - IF YOU SEE THIS, CHANGES ARE WORKING -->
    <div style="background: lime; color: black; font-size: 24px; text-align: center; padding: 20px; border: 5px solid red; position: fixed; top: 0; left: 0; right: 0; z-index: 99999;">
        ‚úÖ CHANGES ARE WORKING! - Current time: <span id="currentTime"></span>
    </div>
    <div style="margin-top: 80px;"></div> <!-- Space for fixed header -->

    <!-- Debug: Test element to ensure page loads -->
    <div style="background: red; color: white; padding: 10px; text-align: center; position: fixed; top: 0; left: 0; right: 0; z-index: 9999; display: none;" id="debugMsg">
        üîß Debug: Page loaded successfully
    </div>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
            <h1 style="margin: 0;">üè• SkinCare AI - Simple Test</h1>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <a href="outbreak-alerts.html" style="background: #ff6b6b; color: white; padding: 12px 20px; border-radius: 25px; text-decoration: none; font-weight: 600; transition: all 0.3s; display: flex; align-items: center; gap: 8px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(255,107,107,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    üö® Outbreak Alerts
                </a>
                <button onclick="window.open('simple-test.html', '_self')" style="background: #667eea; color: white; padding: 12px 20px; border: none; border-radius: 25px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(102,126,234,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    üè† Main Dashboard
                </button>
            </div>
        </div>
        
        <div id="status" class="status warning">
            <strong>Status:</strong> Checking AI service connection...
        </div>

        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
            <div class="upload-content">
                <div class="upload-icon">ÔøΩ</div>
                <div class="upload-text">Upload Skin Photo for Analysis</div>
                <div class="upload-subtext">Drag & drop an image here or click to browse</div>
                <input type="file" id="fileInput" accept="image/*" multiple>
                <button class="btn">
                    <span>üìÅ</span>
                    Choose Files
                </button>
                <div class="file-info hidden" id="fileInfo"></div>
            </div>
        </div>

        <div class="analysis-controls">
            <button class="btn" id="analyzeBtn" onclick="startAnalysis()" disabled>
                <span>üîç</span>
                Analyze Image
            </button>
            <button class="btn secondary" onclick="clearAnalysis()">
                <span>üóëÔ∏è</span>
                Clear
            </button>
            <button class="btn secondary" onclick="toggleHistory()">
                <span>üìä</span>
                View History
            </button>
        </div>

        <div id="analysisProgress" class="analysis-progress">
            <div class="progress-spinner"></div>
            <div class="progress-text">Analyzing your image...</div>
            <div class="progress-subtext">This may take a few moments</div>
        </div>

        <div id="result" class="result">
            <div class="result-header">
                <div class="result-title">üìã Analysis Results</div>
                <div class="result-timestamp" id="resultTimestamp"></div>
            </div>
            <div class="result-content">
                <div class="image-section">
                    <img id="preview" class="preview" alt="Analyzed image">
                    <div class="image-info" id="imageInfo"></div>
                </div>
                <div class="analysis-details">
                    <div id="conditionCard" class="condition-card"></div>
                    <div id="treatmentCard" class="treatment-card"></div>
                </div>
            </div>
            <div class="disclaimer-card">
                <p class="disclaimer-text">
                    <strong>‚ö†Ô∏è Medical Disclaimer:</strong> This AI analysis is for educational and informational purposes only. 
                    It should not be used as a substitute for professional medical advice, diagnosis, or treatment. 
                    Always consult with a qualified healthcare provider for proper medical evaluation and treatment.
                </p>
            </div>
        </div>

        <div id="historySection" class="history-section hidden">
            <div class="history-header">
                <div class="history-title">üìä Analysis History</div>
                <button class="btn danger" onclick="clearHistory()">
                    <span>üóëÔ∏è</span>
                    Clear History
                </button>
            </div>
            <div id="historyList" class="history-list">
                <!-- History items will be populated here -->
            </div>
        </div>
    </div>

    <!-- OUTBREAK ALERTS - STANDALONE SECTION -->
    <div style="margin: 2rem 0; padding: 1rem; background: #f0f0f0; text-align: center; border: 3px dashed #007bff;">
        <h2 style="color: #007bff; margin: 0;">üö® OUTBREAK ALERTS SECTION</h2>
        <p style="margin: 0.5rem 0 0 0; color: #666;">This section is visible and working!</p>
    </div>
    
    <div class="outbreak-section" style="display: block !important; visibility: visible !important;">
        <div class="outbreak-header">
            <h2 class="outbreak-title">üö® Disease Outbreak Alerts</h2>
            <div class="outbreak-subtitle">Real-time monitoring of skin disease outbreaks worldwide</div>
        </div>

        <div class="outbreak-controls">
            <div class="control-group">
                <button class="btn success" onclick="testOutbreakFunction()">
                    <span>üîî</span>
                    <span>Test Alerts</span>
                </button>
                <button class="btn" onclick="testRefresh()">
                    <span>üîÑ</span>
                    Test Refresh
                </button>
            </div>
        </div>
        
        <div class="outbreak-status">
            <div class="status-indicator">
                <span class="indicator-dot green pulsing"></span>
                <span class="status-text">TEST MODE - Section is working!</span>
            </div>
            <div class="last-update">Last updated: <span>Right now</span></div>
        </div>

        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-content">
                    <div class="stat-number">123</div>
                    <div class="stat-label">Test Cases</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üö®</div>
                <div class="stat-content">
                    <div class="stat-number">3</div>
                    <div class="stat-label">Test Outbreaks</div>
                </div>
            </div>
        </div>

        <div class="outbreak-alerts">
            <div class="alerts-header">
                <h3>üì¢ Test Alerts</h3>
            </div>
            <div class="alerts-list">
                <div class="alert-item high">
                    <div class="alert-header">
                        <h4 class="alert-title">Test High Alert</h4>
                        <span class="alert-severity high">HIGH</span>
                    </div>
                    <div class="alert-location">üìç Test Location</div>
                    <div class="alert-description">This is a test alert to verify the section is working properly.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Alerts Section -->
    <div class="notification-section">
        <div class="notification-header">
            <h2 class="notification-title">üîî Notification Center</h2>
            <div class="notification-subtitle">Manage your alerts and notifications</div>
        </div>

        <div class="notification-controls">
            <div class="control-group">
                <button class="btn success" onclick="enableAllNotifications()" id="masterNotificationBtn">
                    <span id="masterNotificationIcon">üîî</span>
                    <span id="masterNotificationText">Enable All Notifications</span>
                </button>
                <button class="btn secondary" onclick="clearAllNotifications()">
                    <span>üóëÔ∏è</span>
                    Clear All
                </button>
                <button class="btn" onclick="testNotification()">
                    <span>üß™</span>
                    Test Notification
                </button>
            </div>
            <div class="notification-settings">
                <label class="setting-item">
                    <input type="checkbox" id="outbreakNotifications" checked>
                    <span class="setting-label">üö® Outbreak Alerts</span>
                </label>
                <label class="setting-item">
                    <input type="checkbox" id="analysisNotifications" checked>
                    <span class="setting-label">üìä Analysis Results</span>
                </label>
                <label class="setting-item">
                    <input type="checkbox" id="systemNotifications" checked>
                    <span class="setting-label">‚öôÔ∏è System Updates</span>
                </label>
                <label class="setting-item">
                    <input type="checkbox" id="soundNotifications" checked>
                    <span class="setting-label">üîä Sound Alerts</span>
                </label>
            </div>
        </div>

        <div class="notification-status">
            <div class="status-indicator">
                <span class="indicator-dot green pulsing"></span>
                <span class="status-text" id="notificationStatusText">Notifications enabled - Ready to receive alerts</span>
            </div>
            <div class="permission-status" id="permissionStatus">
                Browser permission: <span id="permissionState">Checking...</span>
            </div>
        </div>

        <div class="notification-types">
            <h3>üì± Notification Types</h3>
            <div class="notification-grid">
                <div class="notification-type-card outbreak">
                    <div class="type-icon">üö®</div>
                    <div class="type-content">
                        <h4>Outbreak Alerts</h4>
                        <p>High-priority disease outbreak warnings in your area</p>
                        <div class="type-settings">
                            <select class="priority-select" id="outbreakPriority">
                                <option value="all">All Severity</option>
                                <option value="high" selected>High Priority Only</option>
                                <option value="critical">Critical Only</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="notification-type-card analysis">
                    <div class="type-icon">üìä</div>
                    <div class="type-content">
                        <h4>Analysis Complete</h4>
                        <p>Notifications when your skin analysis is ready</p>
                        <div class="type-settings">
                            <select class="priority-select" id="analysisPriority">
                                <option value="always" selected>Always Notify</option>
                                <option value="concerns">Concerns Only</option>
                                <option value="never">Never</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="notification-type-card system">
                    <div class="type-icon">‚öôÔ∏è</div>
                    <div class="type-content">
                        <h4>System Updates</h4>
                        <p>App updates and maintenance notifications</p>
                        <div class="type-settings">
                            <select class="priority-select" id="systemPriority">
                                <option value="important" selected>Important Only</option>
                                <option value="all">All Updates</option>
                                <option value="none">None</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="notification-type-card reminders">
                    <div class="type-icon">‚è∞</div>
                    <div class="type-content">
                        <h4>Health Reminders</h4>
                        <p>Skin care routine and checkup reminders</p>
                        <div class="type-settings">
                            <select class="priority-select" id="reminderFrequency">
                                <option value="daily">Daily</option>
                                <option value="weekly" selected>Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="never">Never</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="notification-history">
            <div class="history-header">
                <h3>üìú Recent Notifications</h3>
                <div class="history-controls">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="outbreak">Outbreaks</button>
                    <button class="filter-btn" data-filter="analysis">Analysis</button>
                    <button class="filter-btn" data-filter="system">System</button>
                </div>
            </div>
            <div id="notificationHistory" class="notification-list">
                <!-- Notification history will be populated here -->
            </div>
        </div>

        <div class="notification-tips">
            <h3>üí° Notification Tips</h3>
            <div class="tips-grid">
                <div class="tip-card">
                    <div class="tip-icon">üîî</div>
                    <div class="tip-content">
                        <h4>Enable Browser Notifications</h4>
                        <p>Allow notifications in your browser settings to receive real-time alerts even when the app is closed.</p>
                    </div>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">‚ö°</div>
                    <div class="tip-content">
                        <h4>Customize Priority Levels</h4>
                        <p>Set different notification priorities to only receive the most important alerts that matter to you.</p>
                    </div>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">üîä</div>
                    <div class="tip-content">
                        <h4>Sound Alerts</h4>
                        <p>Enable sound notifications for critical outbreak alerts to ensure you never miss important health information.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Health Dashboard Section -->
    <div class="dashboard-section">
        <div class="dashboard-header">
            <h2 class="dashboard-title">üìà Health Dashboard</h2>
            <div class="dashboard-subtitle">Track your skin health progress over time</div>
        </div>

        <div class="dashboard-stats-grid">
            <div class="dashboard-card analysis-count">
                <div class="card-icon">üìä</div>
                <div class="card-content">
                    <h3 id="totalAnalyses">0</h3>
                    <p>Total Analyses</p>
                </div>
            </div>
            <div class="dashboard-card improvement-rate">
                <div class="card-icon">üìà</div>
                <div class="card-content">
                    <h3 id="improvementRate">--</h3>
                    <p>Improvement Rate</p>
                </div>
            </div>
            <div class="dashboard-card streak">
                <div class="card-icon">üî•</div>
                <div class="card-content">
                    <h3 id="healthStreak">0</h3>
                    <p>Day Streak</p>
                </div>
            </div>
            <div class="dashboard-card next-checkup">
                <div class="card-icon">üìÖ</div>
                <div class="card-content">
                    <h3 id="nextCheckup">--</h3>
                    <p>Next Checkup</p>
                </div>
            </div>
        </div>

        <div class="progress-charts">
            <div class="chart-container">
                <h3>üìä Skin Health Trends</h3>
                <canvas id="healthChart" width="400" height="200"></canvas>
            </div>
            <div class="recent-activity">
                <h3>üïí Recent Activity</h3>
                <div id="recentActivityList" class="activity-list">
                    <!-- Recent activities will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Treatment Recommendations Section -->
    <div class="treatment-section">
        <div class="treatment-header">
            <h2 class="treatment-title">üíä Personalized Treatment Plans</h2>
            <div class="treatment-subtitle">AI-powered recommendations based on your analysis</div>
        </div>

        <div class="treatment-plans">
            <div class="treatment-plan active">
                <div class="plan-header">
                    <h3>üéØ Current Plan</h3>
                    <span class="plan-status">Active</span>
                </div>
                <div class="plan-content" id="currentPlan">
                    <div class="plan-item">
                        <div class="plan-icon">üß¥</div>
                        <div class="plan-details">
                            <h4>Daily Moisturizer</h4>
                            <p>Apply gentle, fragrance-free moisturizer twice daily</p>
                            <div class="plan-schedule">Morning & Evening</div>
                        </div>
                        <div class="plan-status-check">
                            <input type="checkbox" id="moisturizer" />
                        </div>
                    </div>
                    <div class="plan-item">
                        <div class="plan-icon">‚òÄÔ∏è</div>
                        <div class="plan-details">
                            <h4>Sun Protection</h4>
                            <p>Use SPF 30+ sunscreen daily, even indoors</p>
                            <div class="plan-schedule">Daily</div>
                        </div>
                        <div class="plan-status-check">
                            <input type="checkbox" id="sunscreen" />
                        </div>
                    </div>
                    <div class="plan-item">
                        <div class="plan-icon">üöø</div>
                        <div class="plan-details">
                            <h4>Gentle Cleansing</h4>
                            <p>Use mild, pH-balanced cleanser once daily</p>
                            <div class="plan-schedule">Evening</div>
                        </div>
                        <div class="plan-status-check">
                            <input type="checkbox" id="cleansing" />
                        </div>
                    </div>
                </div>
                <div class="plan-progress">
                    <div class="progress-label">Today's Progress</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="planProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-text"><span id="progressPercent">0</span>% Complete</div>
                </div>
            </div>

            <div class="treatment-recommendations">
                <h3>üí° Recommended Treatments</h3>
                <div class="recommendation-grid" id="recommendationGrid">
                    <!-- Recommendations will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Appointment Scheduler Section -->
    <div class="appointment-section">
        <div class="appointment-header">
            <h2 class="appointment-title">üë®‚Äç‚öïÔ∏è Schedule Dermatologist Consultation</h2>
            <div class="appointment-subtitle">Connect with certified dermatologists for professional advice</div>
        </div>

        <div class="appointment-content">
            <div class="doctor-selection">
                <h3>üè• Available Specialists</h3>
                <div class="doctor-grid">
                    <div class="doctor-card" data-doctor="dr-smith">
                        <div class="doctor-avatar">üë®‚Äç‚öïÔ∏è</div>
                        <div class="doctor-info">
                            <h4>Dr. James Smith</h4>
                            <p>Dermatology Specialist</p>
                            <div class="doctor-rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 4.9/5</div>
                            <div class="doctor-experience">15+ years experience</div>
                        </div>
                        <button class="select-doctor-btn" onclick="selectDoctor('dr-smith')">Select</button>
                    </div>
                    <div class="doctor-card" data-doctor="dr-johnson">
                        <div class="doctor-avatar">üë©‚Äç‚öïÔ∏è</div>
                        <div class="doctor-info">
                            <h4>Dr. Sarah Johnson</h4>
                            <p>Pediatric Dermatologist</p>
                            <div class="doctor-rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 4.8/5</div>
                            <div class="doctor-experience">12+ years experience</div>
                        </div>
                        <button class="select-doctor-btn" onclick="selectDoctor('dr-johnson')">Select</button>
                    </div>
                    <div class="doctor-card" data-doctor="dr-chen">
                        <div class="doctor-avatar">üë®‚Äç‚öïÔ∏è</div>
                        <div class="doctor-info">
                            <h4>Dr. Michael Chen</h4>
                            <p>Cosmetic Dermatology</p>
                            <div class="doctor-rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 4.7/5</div>
                            <div class="doctor-experience">10+ years experience</div>
                        </div>
                        <button class="select-doctor-btn" onclick="selectDoctor('dr-chen')">Select</button>
                    </div>
                </div>
            </div>

            <div class="appointment-booking">
                <h3>üìÖ Book Your Appointment</h3>
                <div class="booking-form">
                    <div class="form-group">
                        <label for="appointmentType">Consultation Type</label>
                        <select id="appointmentType" class="form-control">
                            <option value="general">General Consultation</option>
                            <option value="follow-up">Follow-up Visit</option>
                            <option value="urgent">Urgent Consultation</option>
                            <option value="second-opinion">Second Opinion</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="appointmentDate">Preferred Date</label>
                        <input type="date" id="appointmentDate" class="form-control" min="">
                    </div>
                    <div class="form-group">
                        <label for="appointmentTime">Preferred Time</label>
                        <select id="appointmentTime" class="form-control">
                            <option value="09:00">9:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="14:00">2:00 PM</option>
                            <option value="15:00">3:00 PM</option>
                            <option value="16:00">4:00 PM</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="symptoms">Describe Your Concerns</label>
                        <textarea id="symptoms" class="form-control" rows="4" placeholder="Please describe your skin concerns and any symptoms you're experiencing..."></textarea>
                    </div>
                    <button class="btn success large" onclick="bookAppointment()">
                        <span>üìÖ</span>
                        Book Appointment
                    </button>
                </div>
            </div>
        </div>

        <div class="appointment-history">
            <h3>üìã Your Appointments</h3>
            <div id="appointmentHistory" class="appointment-list">
                <!-- Appointment history will be populated here -->
            </div>
        </div>
    </div>

    <!-- Educational Resources Section -->
    <div class="education-section">
        <div class="education-header">
            <h2 class="education-title">üìö Skin Health Education</h2>
            <div class="education-subtitle">Learn about skin conditions, treatments, and prevention</div>
        </div>

        <div class="education-categories">
            <div class="category-tabs">
                <button class="tab-btn active" data-category="basics" onclick="switchCategory('basics')">Skin Basics</button>
                <button class="tab-btn" data-category="conditions" onclick="switchCategory('conditions')">Conditions</button>
                <button class="tab-btn" data-category="treatments" onclick="switchCategory('treatments')">Treatments</button>
                <button class="tab-btn" data-category="prevention" onclick="switchCategory('prevention')">Prevention</button>
            </div>

            <div class="education-content">
                <div class="category-content active" id="basics">
                    <div class="article-grid">
                        <article class="education-article">
                            <div class="article-image">üî¨</div>
                            <h3>Understanding Your Skin</h3>
                            <p>Learn about the structure and function of your skin, including the epidermis, dermis, and subcutaneous layers.</p>
                            <button class="read-more-btn" onclick="openArticle('skin-structure')">Read More</button>
                        </article>
                        <article class="education-article">
                            <div class="article-image">üß¨</div>
                            <h3>Skin Types & Characteristics</h3>
                            <p>Discover different skin types (normal, dry, oily, combination, sensitive) and their unique care requirements.</p>
                            <button class="read-more-btn" onclick="openArticle('skin-types')">Read More</button>
                        </article>
                        <article class="education-article">
                            <div class="article-image">üåû</div>
                            <h3>Daily Skin Care Routine</h3>
                            <p>Essential steps for maintaining healthy skin including cleansing, moisturizing, and sun protection.</p>
                            <button class="read-more-btn" onclick="openArticle('daily-routine')">Read More</button>
                        </article>
                    </div>
                </div>

                <div class="category-content" id="conditions">
                    <div class="article-grid">
                        <article class="education-article">
                            <div class="article-image">üî¥</div>
                            <h3>Acne: Causes & Treatment</h3>
                            <p>Comprehensive guide to understanding acne, its causes, and effective treatment options.</p>
                            <button class="read-more-btn" onclick="openArticle('acne-guide')">Read More</button>
                        </article>
                        <article class="education-article">
                            <div class="article-image">üü°</div>
                            <h3>Eczema Management</h3>
                            <p>Learn about atopic dermatitis, triggers, and strategies for managing eczema flare-ups.</p>
                            <button class="read-more-btn" onclick="openArticle('eczema-guide')">Read More</button>
                        </article>
                        <article class="education-article">
                            <div class="article-image">üü†</div>
                            <h3>Psoriasis Understanding</h3>
                            <p>Detailed information about psoriasis types, symptoms, and modern treatment approaches.</p>
                            <button class="read-more-btn" onclick="openArticle('psoriasis-guide')">Read More</button>
                        </article>
                    </div>
                </div>

                <div class="category-content" id="treatments">
                    <div class="article-grid">
                        <article class="education-article">
                            <div class="article-image">üíä</div>
                            <h3>Topical Treatments</h3>
                            <p>Guide to topical medications, creams, and ointments for various skin conditions.</p>
                            <button class="read-more-btn" onclick="openArticle('topical-treatments')">Read More</button>
                        </article>
                        <article class="education-article">
                            <div class="article-image">üî¨</div>
                            <h3>Advanced Therapies</h3>
                            <p>Modern treatment options including light therapy, biologics, and laser treatments.</p>
                            <button class="read-more-btn" onclick="openArticle('advanced-therapies')">Read More</button>
                        </article>
                        <article class="education-article">
                            <div class="article-image">üåø</div>
                            <h3>Natural Remedies</h3>
                            <p>Evidence-based natural and home remedies that can complement medical treatments.</p>
                            <button class="read-more-btn" onclick="openArticle('natural-remedies')">Read More</button>
                        </article>
                    </div>
                </div>

                <div class="category-content" id="prevention">
                    <div class="article-grid">
                        <article class="education-article">
                            <div class="article-image">‚òÄÔ∏è</div>
                            <h3>Sun Protection</h3>
                            <p>Essential sun safety practices, choosing the right SPF, and preventing skin damage.</p>
                            <button class="read-more-btn" onclick="openArticle('sun-protection')">Read More</button>
                        </article>
                        <article class="education-article">
                            <div class="article-image">ü•ó</div>
                            <h3>Nutrition for Healthy Skin</h3>
                            <p>How diet affects skin health and foods that promote clear, healthy skin.</p>
                            <button class="read-more-btn" onclick="openArticle('skin-nutrition')">Read More</button>
                        </article>
                        <article class="education-article">
                            <div class="article-image">üíß</div>
                            <h3>Lifestyle & Skin Health</h3>
                            <p>Impact of sleep, stress, exercise, and hydration on skin health and appearance.</p>
                            <button class="read-more-btn" onclick="openArticle('lifestyle-skin')">Read More</button>
                        </article>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5001';
        
        // DOM Elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const result = document.getElementById('result');
        const analysisProgress = document.getElementById('analysisProgress');
        const preview = document.getElementById('preview');
        const imageInfo = document.getElementById('imageInfo');
        const conditionCard = document.getElementById('conditionCard');
        const treatmentCard = document.getElementById('treatmentCard');
        const resultTimestamp = document.getElementById('resultTimestamp');
        const status = document.getElementById('status');
        const historySection = document.getElementById('historySection');
        const historyList = document.getElementById('historyList');

        // State
        let currentFiles = [];
        let analysisHistory = JSON.parse(localStorage.getItem('skincare_history') || '[]');
        let isAnalyzing = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkAIService();
            setupEventListeners();
            loadHistory();
        });

        function setupEventListeners() {
            // File input change
            fileInput.addEventListener('change', handleFileSelect);
            
            // Drag and drop events
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            
            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });
        }

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function handleDragOver(e) {
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave(e) {
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            uploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            processFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            processFiles(files);
        }

        function processFiles(files) {
            // Filter for image files only
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                showNotification('Please select valid image files (PNG, JPG, JPEG, GIF, WebP)', 'error');
                return;
            }

            // Validate file sizes (max 10MB each)
            const oversizedFiles = imageFiles.filter(file => file.size > 10 * 1024 * 1024);
            if (oversizedFiles.length > 0) {
                showNotification(`Some files are too large. Maximum size is 10MB per file.`, 'error');
                return;
            }

            currentFiles = imageFiles;
            updateFileInfo();
            uploadArea.classList.add('has-file');
            analyzeBtn.disabled = false;

            // Auto-preview first image
            if (imageFiles.length > 0) {
                previewImage(imageFiles[0]);
            }
        }

        function updateFileInfo() {
            if (currentFiles.length === 0) {
                fileInfo.classList.add('hidden');
                return;
            }

            const totalSize = currentFiles.reduce((sum, file) => sum + file.size, 0);
            const sizeText = formatFileSize(totalSize);
            
            fileInfo.innerHTML = `
                <strong>${currentFiles.length}</strong> file${currentFiles.length > 1 ? 's' : ''} selected 
                (${sizeText} total)
            `;
            fileInfo.classList.remove('hidden');
        }

        function previewImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                imageInfo.innerHTML = `
                    <strong>File:</strong> ${file.name}<br>
                    <strong>Size:</strong> ${formatFileSize(file.size)}<br>
                    <strong>Type:</strong> ${file.type}
                `;
            };
            reader.readAsDataURL(file);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function checkAIService() {
            try {
                const response = await fetch(`${API_URL}/health`, { 
                    method: 'GET',
                    signal: AbortSignal.timeout(5000)
                });
                
                if (response.ok) {
                    status.className = 'status success';
                    status.innerHTML = '<strong>‚úÖ AI Service Connected:</strong> Ready to analyze images!';
                    return true;
                } else {
                    throw new Error('Service not responding');
                }
            } catch (error) {
                status.className = 'status error';
                status.innerHTML = '<strong>‚ùå AI Service Offline:</strong> Please start the AI service first. <code>cd ai-service && python app.py</code>';
                return false;
            }
        }

        async function startAnalysis() {
            if (currentFiles.length === 0 || isAnalyzing) return;

            isAnalyzing = true;
            analyzeBtn.disabled = true;
            
            // Show progress
            result.style.display = 'none';
            analysisProgress.style.display = 'block';

            try {
                // Check service availability
                const serviceAvailable = await checkAIService();
                if (!serviceAvailable) {
                    throw new Error('AI service is not available');
                }

                // Analyze first image (can be extended for multiple images)
                const file = currentFiles[0];
                const analysisResult = await analyzeImage(file);
                
                // Display results
                displayAnalysisResult(analysisResult, file);
                
                // Save to history
                saveToHistory(analysisResult, file);

            } catch (error) {
                console.error('Analysis error:', error);
                showNotification(`Analysis failed: ${error.message}`, 'error');
                analysisProgress.style.display = 'none';
            } finally {
                isAnalyzing = false;
                analyzeBtn.disabled = false;
            }
        }

        async function analyzeImage(file) {
            const formData = new FormData();
            formData.append('image', file);

            const response = await fetch(`${API_URL}/analyze`, {
                method: 'POST',
                body: formData,
                signal: AbortSignal.timeout(30000) // 30 second timeout
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            
            if (data.error) {
                throw new Error(data.error);
            }

            return data;
        }

        function displayAnalysisResult(data, file) {
            // Hide progress, show results
            analysisProgress.style.display = 'none';
            result.style.display = 'block';

            // Set timestamp
            resultTimestamp.textContent = new Date().toLocaleString();

            // Preview image
            previewImage(file);

            // Display condition information
            displayConditionCard(data);
            
            // Display treatment information
            displayTreatmentCard(data);

            // Scroll to results
            result.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function displayConditionCard(data) {
            const confidence = Math.round((data.confidence || 0) * 100);
            const condition = data.condition || 'Unknown Condition';
            const description = data.description || 'No description available.';
            const severity = data.severity || 'unknown';

            conditionCard.innerHTML = `
                <div class="condition-header">
                    <div class="condition-name">üéØ ${condition}</div>
                    <div class="confidence-badge">${confidence}% Confidence</div>
                </div>
                <div class="condition-description">${description}</div>
                <div class="severity-indicator">
                    <span class="severity-dot ${severity}"></span>
                    <span><strong>Severity:</strong> ${severity.charAt(0).toUpperCase() + severity.slice(1)}</span>
                </div>
                ${data.symptoms ? `
                    <details style="margin-top: 15px;">
                        <summary style="cursor: pointer; font-weight: 600; color: #155724;">
                            üîç Common Symptoms
                        </summary>
                        <ul style="margin: 10px 0 0 20px; color: #155724;">
                            ${data.symptoms.map(symptom => `<li>${symptom}</li>`).join('')}
                        </ul>
                    </details>
                ` : ''}
            `;
        }

        function displayTreatmentCard(data) {
            const treatments = data.treatments || data.recommendations || ['Consult a healthcare professional for proper diagnosis and treatment.'];
            
            treatmentCard.innerHTML = `
                <div class="treatment-title">
                    <span>üíä</span>
                    Treatment Recommendations
                </div>
                <ul class="treatment-list">
                    ${treatments.map(treatment => `
                        <li class="treatment-item">
                            <span class="treatment-icon">‚úì</span>
                            <span>${treatment}</span>
                        </li>
                    `).join('')}
                </ul>
                ${data.preventive_measures ? `
                    <details style="margin-top: 15px;">
                        <summary style="cursor: pointer; font-weight: 600; color: #1565c0;">
                            üõ°Ô∏è Preventive Measures
                        </summary>
                        <ul style="margin: 10px 0 0 20px; color: #1565c0;">
                            ${data.preventive_measures.map(measure => `<li>${measure}</li>`).join('')}
                        </ul>
                    </details>
                ` : ''}
            `;
        }

        function saveToHistory(analysisResult, file) {
            const historyItem = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                fileName: file.name,
                fileSize: file.size,
                condition: analysisResult.condition || 'Unknown',
                confidence: analysisResult.confidence || 0,
                imageData: preview.src, // Base64 image data
                fullResult: analysisResult
            };

            analysisHistory.unshift(historyItem);
            
            // Keep only last 20 analyses
            if (analysisHistory.length > 20) {
                analysisHistory = analysisHistory.slice(0, 20);
            }

            localStorage.setItem('skincare_history', JSON.stringify(analysisHistory));
            loadHistory();
        }

        function loadHistory() {
            if (analysisHistory.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No previous analyses found.</div>';
                return;
            }

            historyList.innerHTML = analysisHistory.map(item => `
                <div class="history-item" onclick="loadHistoryItem('${item.id}')">
                    <div class="history-info">
                        <img src="${item.imageData}" alt="Analysis thumbnail" class="history-thumbnail">
                        <div class="history-details">
                            <div class="history-condition">${item.condition}</div>
                            <div class="history-date">${new Date(item.timestamp).toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="history-confidence">${Math.round(item.confidence * 100)}%</div>
                </div>
            `).join('');
        }

        function loadHistoryItem(id) {
            const item = analysisHistory.find(h => h.id.toString() === id);
            if (!item) return;

            // Create a mock file object for display
            const mockFile = {
                name: item.fileName,
                size: item.fileSize,
                type: 'image/jpeg'
            };

            // Display the historical analysis
            displayAnalysisResult(item.fullResult, mockFile);
            
            // Update preview with stored image
            preview.src = item.imageData;
            
            // Hide history and scroll to results
            historySection.classList.add('hidden');
            result.scrollIntoView({ behavior: 'smooth' });
        }

        function clearAnalysis() {
            currentFiles = [];
            fileInput.value = '';
            fileInfo.classList.add('hidden');
            uploadArea.classList.remove('has-file', 'dragover');
            result.style.display = 'none';
            analysisProgress.style.display = 'none';
            analyzeBtn.disabled = true;
            
            showNotification('Analysis cleared', 'info');
        }

        function toggleHistory() {
            if (historySection.classList.contains('hidden')) {
                historySection.classList.remove('hidden');
                loadHistory();
                historySection.scrollIntoView({ behavior: 'smooth' });
            } else {
                historySection.classList.add('hidden');
            }
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear all analysis history? This action cannot be undone.')) {
                analysisHistory = [];
                localStorage.removeItem('skincare_history');
                loadHistory();
                showNotification('Analysis history cleared', 'info');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'error' ? '#f8d7da' : type === 'success' ? '#d4edda' : '#d1ecf1'};
                color: ${type === 'error' ? '#721c24' : type === 'success' ? '#155724' : '#0c5460'};
                border: 1px solid ${type === 'error' ? '#f5c6cb' : type === 'success' ? '#c3e6cb' : '#bee5eb'};
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                max-width: 300px;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            notification.innerHTML = `
                <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; font-size: 18px; cursor: pointer; margin-left: 10px;">&times;</button>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'o':
                        e.preventDefault();
                        fileInput.click();
                        break;
                    case 'Enter':
                        if (!analyzeBtn.disabled) {
                            e.preventDefault();
                            startAnalysis();
                        }
                        break;
                    case 'h':
                        e.preventDefault();
                        toggleHistory();
                        break;
                }
            }
        });

        // Outbreak Alerts System
        let outbreakData = [];
        let notificationsEnabled = false;
        let outbreakInterval = null;
        let currentFilter = 'all';

        // Initialize outbreak monitoring
        function initializeOutbreakMonitoring() {
            console.log('Starting outbreak monitoring initialization...');
            
            // First load mock data to ensure something is always displayed
            loadMockData();
            
            // Then try to get real data
            refreshOutbreaks();
            setupEventListeners();
            
            // Auto-refresh every 5 minutes
            if (outbreakInterval) {
                clearInterval(outbreakInterval);
            }
            outbreakInterval = setInterval(refreshOutbreaks, 5 * 60 * 1000);
            
            console.log('Outbreak monitoring initialized successfully');
        }

        function setupEventListeners() {
            // Location filter
            const locationSelect = document.getElementById('locationSelect');
            if (locationSelect) {
                locationSelect.addEventListener('change', refreshOutbreaks);
            }

            // Severity filters
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.severity;
                    filterAlerts();
                });
            });
        }

        async function enableNotifications() {
            const icon = document.getElementById('notificationIcon');
            const text = document.getElementById('notificationText');
            
            if (!notificationsEnabled) {
                // Request notification permission
                if ('Notification' in window) {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        notificationsEnabled = true;
                        icon.textContent = 'üîî';
                        text.textContent = 'Alerts Enabled';
                        
                        // Show confirmation notification
                        new Notification('Outbreak Alerts Enabled', {
                            body: 'You will now receive notifications about skin disease outbreaks in your area.',
                            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üö®</text></svg>'
                        });
                        
                        updateStatus('green', 'Notifications enabled - Monitoring for outbreaks...');
                    } else {
                        alert('Please enable notifications to receive outbreak alerts.');
                    }
                } else {
                    alert('Notifications are not supported in this browser.');
                }
            } else {
                notificationsEnabled = false;
                icon.textContent = 'üîï';
                text.textContent = 'Enable Alerts';
                updateStatus('yellow', 'Monitoring active - Notifications disabled');
            }
        }

        async function refreshOutbreaks() {
            const location = document.getElementById('locationSelect')?.value || 'global';
            
            try {
                updateStatus('yellow', 'Fetching latest outbreak data...');
                
                // Fetch outbreak data from AI service
                const [outbreaksResponse, statsResponse] = await Promise.all([
                    fetch('http://localhost:5001/outbreaks'),
                    fetch('http://localhost:5001/outbreak-stats')
                ]);
                
                if (outbreaksResponse.ok && statsResponse.ok) {
                    const outbreaks = await outbreaksResponse.json();
                    const stats = await statsResponse.json();
                    
                    outbreakData = outbreaks.outbreaks || [];
                    updateDashboard(stats);
                    updateAlerts(outbreakData);
                    updateInsights(stats);
                    updateStatus('green', 'Data updated successfully');
                    
                    // Check for new high-severity outbreaks
                    checkForNewOutbreaks(outbreakData);
                } else {
                    throw new Error('Failed to fetch outbreak data');
                }
            } catch (error) {
                console.error('Error fetching outbreak data:', error);
                updateStatus('red', 'Unable to fetch outbreak data - Using cached data');
                loadMockData();
            }
            
            document.getElementById('lastUpdateTime').textContent = new Date().toLocaleTimeString();
        }

        function loadMockData() {
            // Mock data for demonstration
            outbreakData = [
                {
                    id: 1,
                    title: 'Eczema Outbreak in Metropolitan Area',
                    location: 'New York, NY',
                    severity: 'high',
                    description: 'Increased cases of atopic dermatitis reported in urban areas, possibly linked to air quality.',
                    cases: 156,
                    trend: 'increasing',
                    lastUpdated: '2024-01-15T10:30:00Z'
                },
                {
                    id: 2,
                    title: 'Psoriasis Cases Rising',
                    location: 'Los Angeles, CA',
                    severity: 'medium',
                    description: 'Stress-related psoriasis flare-ups increasing in the region.',
                    cases: 89,
                    trend: 'stable',
                    lastUpdated: '2024-01-15T09:15:00Z'
                },
                {
                    id: 3,
                    title: 'Contact Dermatitis Alert',
                    location: 'Chicago, IL',
                    severity: 'low',
                    description: 'Seasonal allergic contact dermatitis cases within normal range.',
                    cases: 23,
                    trend: 'decreasing',
                    lastUpdated: '2024-01-15T08:45:00Z'
                }
            ];

            const mockStats = {
                totalCases: 268,
                activeOutbreaks: 3,
                riskLevel: 'Medium',
                trend: '+12%',
                insights: [
                    {
                        title: 'Seasonal Pattern',
                        text: 'Eczema cases typically increase during winter months due to dry air and heating systems.'
                    },
                    {
                        title: 'Prevention Tip',
                        text: 'Regular moisturizing and avoiding harsh soaps can help prevent outbreak severity.'
                    }
                ]
            };

            updateDashboard(mockStats);
            updateAlerts(outbreakData);
            updateInsights(mockStats);
        }

        function updateStatus(type, message) {
            const indicator = document.querySelector('.indicator-dot');
            const statusText = document.querySelector('.status-text');
            
            if (indicator && statusText) {
                indicator.className = `indicator-dot ${type} pulsing`;
                statusText.textContent = message;
            }
        }

        function updateDashboard(stats) {
            document.getElementById('totalCases').textContent = stats.totalCases || '--';
            document.getElementById('activeOutbreaks').textContent = stats.activeOutbreaks || '--';
            document.getElementById('riskLevel').textContent = stats.riskLevel || '--';
            document.getElementById('trendIndicator').textContent = stats.trend || '--';
        }

        function updateAlerts(alerts) {
            const alertsList = document.getElementById('alertsList');
            if (!alertsList) return;

            if (alerts.length === 0) {
                alertsList.innerHTML = '<div class="no-alerts">‚úÖ No active outbreak alerts in your area</div>';
                return;
            }

            alertsList.innerHTML = alerts.map(alert => `
                <div class="alert-item ${alert.severity}" data-severity="${alert.severity}">
                    <div class="alert-header">
                        <h4 class="alert-title">${alert.title}</h4>
                        <span class="alert-severity ${alert.severity}">${alert.severity}</span>
                    </div>
                    <div class="alert-location">üìç ${alert.location}</div>
                    <div class="alert-description">${alert.description}</div>
                    <div class="alert-meta">
                        <span>Cases: ${alert.cases}</span>
                        <span>Trend: ${getTrendIcon(alert.trend)} ${alert.trend}</span>
                        <span>Updated: ${formatTime(alert.lastUpdated)}</span>
                    </div>
                </div>
            `).join('');

            filterAlerts();
        }

        function updateInsights(stats) {
            const insightsContent = document.getElementById('outbreakInsights');
            if (!insightsContent || !stats.insights) return;

            insightsContent.innerHTML = stats.insights.map(insight => `
                <div class="insight-card">
                    <div class="insight-title">${insight.title}</div>
                    <div class="insight-text">${insight.text}</div>
                </div>
            `).join('');
        }

        function filterAlerts() {
            const alerts = document.querySelectorAll('.alert-item');
            alerts.forEach(alert => {
                const severity = alert.dataset.severity;
                if (currentFilter === 'all' || severity === currentFilter) {
                    alert.style.display = 'block';
                } else {
                    alert.style.display = 'none';
                }
            });
        }

        function checkForNewOutbreaks(alerts) {
            if (!notificationsEnabled) return;

            alerts.forEach(alert => {
                if (alert.severity === 'high' && isNewAlert(alert)) {
                    showOutbreakNotification(alert);
                }
            });
        }

        function isNewAlert(alert) {
            // Check if this alert was created in the last hour
            const alertTime = new Date(alert.lastUpdated);
            const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);
            return alertTime > oneHourAgo;
        }

        function showOutbreakNotification(alert) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(`üö® High Alert: ${alert.title}`, {
                    body: `${alert.location}: ${alert.description}`,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">‚ö†Ô∏è</text></svg>',
                    tag: `outbreak-${alert.id}`,
                    requireInteraction: true
                });
            }
        }

        function getTrendIcon(trend) {
            switch (trend) {
                case 'increasing': return 'üìà';
                case 'decreasing': return 'üìâ';
                case 'stable': return '‚û°Ô∏è';
                default: return 'üìä';
            }
        }

        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleString();
        }

        // Initialize outbreak monitoring when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Update time display to prove page is working
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.textContent = new Date().toLocaleTimeString();
                setInterval(() => {
                    timeElement.textContent = new Date().toLocaleTimeString();
                }, 1000);
            }
            
            // Show debug message
            const debugMsg = document.getElementById('debugMsg');
            if (debugMsg) {
                debugMsg.style.display = 'block';
                setTimeout(() => {
                    debugMsg.style.display = 'none';
                }, 3000);
            }
            
            // Initialize outbreak monitoring immediately
            console.log('Initializing outbreak monitoring...');
            initializeOutbreakMonitoring();
            
            // Initialize notification system
            console.log('Initializing notification system...');
            initializeNotificationSystem();
            
            // Scroll to notification section for testing
            setTimeout(() => {
                const notificationSection = document.querySelector('.notification-section');
                if (notificationSection) {
                    console.log('Found notification section, scrolling to it...');
                    notificationSection.scrollIntoView({ behavior: 'smooth' });
                    // Highlight it temporarily
                    notificationSection.style.border = '5px solid lime';
                    setTimeout(() => {
                        notificationSection.style.border = '';
                    }, 3000);
                }
            }, 3000);
        });

        // Simple test functions for the outbreak section
        function testOutbreakFunction() {
            alert('üö® Outbreak alerts test function works!');
        }

        function testRefresh() {
            alert('üîÑ Refresh test function works!');
        }

        // Notification System Functions
        let notificationPermission = 'default';
        let notificationHistory = JSON.parse(localStorage.getItem('notification_history') || '[]');
        let notificationSettings = JSON.parse(localStorage.getItem('notification_settings') || '{}');

        // Initialize notification system
        function initializeNotificationSystem() {
            checkNotificationPermission();
            loadNotificationHistory();
            setupNotificationEventListeners();
            
            // Add some sample notifications if history is empty
            if (notificationHistory.length === 0) {
                addSampleNotifications();
            }
        }

        async function checkNotificationPermission() {
            if ('Notification' in window) {
                notificationPermission = Notification.permission;
                document.getElementById('permissionState').textContent = notificationPermission;
                
                if (notificationPermission === 'granted') {
                    updateNotificationStatus('green', 'Notifications enabled and ready');
                } else if (notificationPermission === 'denied') {
                    updateNotificationStatus('red', 'Notifications blocked by browser');
                } else {
                    updateNotificationStatus('yellow', 'Notification permission not granted');
                }
            } else {
                updateNotificationStatus('red', 'Notifications not supported');
            }
        }

        function updateNotificationStatus(type, message) {
            const indicator = document.querySelector('.notification-section .indicator-dot');
            const statusText = document.getElementById('notificationStatusText');
            
            if (indicator && statusText) {
                indicator.className = `indicator-dot ${type} pulsing`;
                statusText.textContent = message;
            }
        }

        async function enableAllNotifications() {
            const icon = document.getElementById('masterNotificationIcon');
            const text = document.getElementById('masterNotificationText');
            
            if (notificationPermission !== 'granted') {
                const permission = await Notification.requestPermission();
                notificationPermission = permission;
                document.getElementById('permissionState').textContent = permission;
                
                if (permission === 'granted') {
                    icon.textContent = 'üîî';
                    text.textContent = 'Notifications Enabled';
                    updateNotificationStatus('green', 'All notifications enabled successfully');
                    
                    // Show welcome notification
                    showNotification('system', 'Notifications Enabled', 'You will now receive important health alerts and updates.', 'success');
                } else {
                    updateNotificationStatus('red', 'Permission denied - Please enable in browser settings');
                }
            } else {
                // Toggle all notifications off
                icon.textContent = 'üîï';
                text.textContent = 'Enable All Notifications';
                updateNotificationStatus('yellow', 'Notifications disabled');
            }
        }

        function clearAllNotifications() {
            if (confirm('Are you sure you want to clear all notification history?')) {
                notificationHistory = [];
                localStorage.setItem('notification_history', JSON.stringify(notificationHistory));
                loadNotificationHistory();
                showNotification('system', 'History Cleared', 'All notification history has been cleared.', 'info');
            }
        }

        function testNotification() {
            const testTypes = ['outbreak', 'analysis', 'system', 'reminder'];
            const randomType = testTypes[Math.floor(Math.random() * testTypes.length)];
            
            const testMessages = {
                outbreak: { title: 'Test Outbreak Alert', body: 'This is a test outbreak notification.' },
                analysis: { title: 'Test Analysis Complete', body: 'Your skin analysis test is ready for review.' },
                system: { title: 'Test System Update', body: 'This is a test system notification.' },
                reminder: { title: 'Test Health Reminder', body: 'Remember to check your skin health regularly.' }
            };
            
            const message = testMessages[randomType];
            showNotification(randomType, message.title, message.body, 'test');
        }

        function showNotification(type, title, body, priority = 'normal') {
            // Add to history
            const notification = {
                id: Date.now(),
                type: type,
                title: title,
                body: body,
                priority: priority,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            notificationHistory.unshift(notification);
            if (notificationHistory.length > 50) {
                notificationHistory = notificationHistory.slice(0, 50);
            }
            localStorage.setItem('notification_history', JSON.stringify(notificationHistory));
            
            // Show browser notification if enabled
            if (notificationPermission === 'granted') {
                const browserNotification = new Notification(title, {
                    body: body,
                    icon: getNotificationIcon(type),
                    tag: `${type}-${notification.id}`,
                    requireInteraction: priority === 'critical'
                });
                
                browserNotification.onclick = function() {
                    window.focus();
                    browserNotification.close();
                };
            }
            
            // Update display
            loadNotificationHistory();
            
            // Play sound if enabled
            if (document.getElementById('soundNotifications')?.checked) {
                playNotificationSound(type);
            }
        }

        function getNotificationIcon(type) {
            const icons = {
                outbreak: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üö®</text></svg>',
                analysis: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üìä</text></svg>',
                system: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">‚öôÔ∏è</text></svg>',
                reminder: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">‚è∞</text></svg>'
            };
            return icons[type] || icons.system;
        }

        function playNotificationSound(type) {
            // Create simple notification sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Different tones for different notification types
                const frequencies = {
                    outbreak: 800,
                    analysis: 600,
                    system: 400,
                    reminder: 500
                };
                
                oscillator.frequency.setValueAtTime(frequencies[type] || 500, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (error) {
                console.log('Audio notification not available');
            }
        }

        function loadNotificationHistory() {
            const historyContainer = document.getElementById('notificationHistory');
            if (!historyContainer) return;
            
            const currentFilter = document.querySelector('.history-controls .filter-btn.active')?.dataset.filter || 'all';
            let filteredHistory = notificationHistory;
            
            if (currentFilter !== 'all') {
                filteredHistory = notificationHistory.filter(n => n.type === currentFilter);
            }
            
            if (filteredHistory.length === 0) {
                historyContainer.innerHTML = '<div class="no-notifications">üì≠ No notifications found</div>';
                return;
            }
            
            historyContainer.innerHTML = filteredHistory.map(notification => `
                <div class="notification-item ${notification.type}">
                    <div class="notification-item-header">
                        <h4 class="notification-item-title">${getTypeIcon(notification.type)} ${notification.title}</h4>
                        <span class="notification-time">${formatNotificationTime(notification.timestamp)}</span>
                    </div>
                    <div class="notification-content">${notification.body}</div>
                </div>
            `).join('');
        }

        function getTypeIcon(type) {
            const icons = {
                outbreak: 'üö®',
                analysis: 'üìä',
                system: '‚öôÔ∏è',
                reminder: '‚è∞'
            };
            return icons[type] || 'üì¢';
        }

        function formatNotificationTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }

        function setupNotificationEventListeners() {
            // Filter buttons
            document.querySelectorAll('.history-controls .filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.history-controls .filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    loadNotificationHistory();
                });
            });
            
            // Settings checkboxes
            ['outbreakNotifications', 'analysisNotifications', 'systemNotifications', 'soundNotifications'].forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.addEventListener('change', function() {
                        notificationSettings[id] = this.checked;
                        localStorage.setItem('notification_settings', JSON.stringify(notificationSettings));
                    });
                }
            });
        }

        function addSampleNotifications() {
            const sampleNotifications = [
                {
                    type: 'outbreak',
                    title: 'High Alert: Eczema Outbreak',
                    body: 'Increased eczema cases reported in your area. Take extra skin care precautions.',
                    priority: 'high'
                },
                {
                    type: 'analysis',
                    title: 'Analysis Complete',
                    body: 'Your recent skin analysis is ready. Results show normal skin condition.',
                    priority: 'normal'
                },
                {
                    type: 'system',
                    title: 'App Updated',
                    body: 'SkinCare AI has been updated with improved analysis algorithms.',
                    priority: 'normal'
                },
                {
                    type: 'reminder',
                    title: 'Weekly Skin Check',
                    body: 'Time for your weekly skin health check. Upload a new photo for analysis.',
                    priority: 'normal'
                }
            ];
            
            sampleNotifications.forEach((notif, index) => {
                setTimeout(() => {
                    showNotification(notif.type, notif.title, notif.body, notif.priority);
                }, index * 100);
            });
        }

        // Also initialize immediately if DOM is already loaded
        if (document.readyState === 'loading') {
            // Still loading, wait for DOMContentLoaded
        } else {
            // DOM already loaded
            console.log('DOM already loaded, initializing outbreak monitoring...');
            initializeOutbreakMonitoring();
        }

        // Dashboard functionality
        function initializeDashboard() {
            updateDashboardStats();
            initializeChart();
            loadRecentActivity();
        }

        function updateDashboardStats() {
            const analyses = JSON.parse(localStorage.getItem('analysisHistory') || '[]');
            const totalAnalyses = analyses.length;
            
            document.getElementById('totalAnalyses').textContent = totalAnalyses;
            
            // Calculate improvement rate (mock calculation)
            const improvementRate = totalAnalyses > 0 ? Math.min(85 + totalAnalyses * 2, 100) : 0;
            document.getElementById('improvementRate').textContent = improvementRate + '%';
            
            // Calculate streak (mock calculation)
            const streak = Math.floor(totalAnalyses / 3);
            document.getElementById('healthStreak').textContent = streak;
            
            // Next checkup
            const nextCheckup = new Date();
            nextCheckup.setDate(nextCheckup.getDate() + 7);
            document.getElementById('nextCheckup').textContent = nextCheckup.toLocaleDateString();
        }

        function initializeChart() {
            const canvas = document.getElementById('healthChart');
            const ctx = canvas.getContext('2d');
            
            // Simple chart implementation
            const data = [65, 70, 75, 80, 85, 90, 88];
            const labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7'];
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw simple line chart
            const padding = 40;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            
            // Draw axes
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // Draw data points and line
            ctx.strokeStyle = '#4ECDC4';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = padding + (index * chartWidth) / (data.length - 1);
                const y = canvas.height - padding - ((value - 50) / 50) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
                
                // Draw point
                ctx.save();
                ctx.fillStyle = '#4ECDC4';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
                ctx.restore();
            });
            
            ctx.stroke();
        }

        function loadRecentActivity() {
            const activityList = document.getElementById('recentActivityList');
            const analyses = JSON.parse(localStorage.getItem('analysisHistory') || '[]');
            
            if (analyses.length === 0) {
                activityList.innerHTML = '<div class="activity-item">No recent activity</div>';
                return;
            }
            
            const recentAnalyses = analyses.slice(-5).reverse();
            activityList.innerHTML = recentAnalyses.map(analysis => `
                <div class="activity-item">
                    <div style="font-size: 1.5rem;">üìä</div>
                    <div>
                        <strong>Skin Analysis</strong><br>
                        <small>${new Date(analysis.timestamp).toLocaleDateString()}</small>
                    </div>
                </div>
            `).join('');
        }

        // Treatment Plan functionality
        function initializeTreatmentPlan() {
            updatePlanProgress();
            loadRecommendations();
            setupPlanCheckboxes();
        }

        function setupPlanCheckboxes() {
            const checkboxes = document.querySelectorAll('.plan-status-check input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                const savedState = localStorage.getItem(`plan_${checkbox.id}`);
                if (savedState === 'true') {
                    checkbox.checked = true;
                }
                
                checkbox.addEventListener('change', () => {
                    localStorage.setItem(`plan_${checkbox.id}`, checkbox.checked);
                    updatePlanProgress();
                });
            });
        }

        function updatePlanProgress() {
            const checkboxes = document.querySelectorAll('.plan-status-check input[type="checkbox"]');
            const totalTasks = checkboxes.length;
            const completedTasks = Array.from(checkboxes).filter(cb => cb.checked).length;
            
            const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('planProgress').style.width = percentage + '%';
            document.getElementById('progressPercent').textContent = percentage;
        }

        function loadRecommendations() {
            const recommendationGrid = document.getElementById('recommendationGrid');
            const recommendations = [
                {
                    title: 'Vitamin D Supplement',
                    description: 'Consider vitamin D supplementation for skin health',
                    icon: 'üíä'
                },
                {
                    title: 'Hydration Boost',
                    description: 'Increase water intake to 8 glasses daily',
                    icon: 'üíß'
                },
                {
                    title: 'Sleep Quality',
                    description: 'Maintain 7-8 hours of quality sleep for skin repair',
                    icon: 'üò¥'
                }
            ];
            
            recommendationGrid.innerHTML = recommendations.map(rec => `
                <div class="recommendation-card">
                    <div style="font-size: 2rem; text-align: center; margin-bottom: 15px;">${rec.icon}</div>
                    <h4 style="margin: 0 0 10px 0; color: #333;">${rec.title}</h4>
                    <p style="margin: 0; color: #666; line-height: 1.4;">${rec.description}</p>
                </div>
            `).join('');
        }

        // Appointment functionality
        let selectedDoctor = null;

        function selectDoctor(doctorId) {
            // Remove previous selection
            document.querySelectorAll('.doctor-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked doctor
            const doctorCard = document.querySelector(`[data-doctor="${doctorId}"]`);
            doctorCard.classList.add('selected');
            selectedDoctor = doctorId;
            
            // Update button text
            doctorCard.querySelector('.select-doctor-btn').textContent = 'Selected';
        }

        function bookAppointment() {
            if (!selectedDoctor) {
                alert('Please select a doctor first');
                return;
            }
            
            const appointmentType = document.getElementById('appointmentType').value;
            const appointmentDate = document.getElementById('appointmentDate').value;
            const appointmentTime = document.getElementById('appointmentTime').value;
            const symptoms = document.getElementById('symptoms').value;
            
            if (!appointmentDate || !symptoms.trim()) {
                alert('Please fill in all required fields');
                return;
            }
            
            const appointment = {
                id: Date.now(),
                doctor: selectedDoctor,
                type: appointmentType,
                date: appointmentDate,
                time: appointmentTime,
                symptoms: symptoms,
                status: 'scheduled',
                timestamp: new Date().toISOString()
            };
            
            // Save appointment
            const appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
            appointments.push(appointment);
            localStorage.setItem('appointments', JSON.stringify(appointments));
            
            // Clear form
            document.getElementById('appointmentType').value = 'general';
            document.getElementById('appointmentDate').value = '';
            document.getElementById('appointmentTime').value = '09:00';
            document.getElementById('symptoms').value = '';
            
            // Reset doctor selection
            document.querySelectorAll('.doctor-card').forEach(card => {
                card.classList.remove('selected');
                card.querySelector('.select-doctor-btn').textContent = 'Select';
            });
            selectedDoctor = null;
            
            alert('Appointment booked successfully!');
            loadAppointmentHistory();
        }

        function loadAppointmentHistory() {
            const appointmentHistory = document.getElementById('appointmentHistory');
            const appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
            
            if (appointments.length === 0) {
                appointmentHistory.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No appointments scheduled</div>';
                return;
            }
            
            appointmentHistory.innerHTML = appointments.reverse().map(appointment => `
                <div class="appointment-item">
                    <div style="display: flex; justify-content: between; align-items: center;">
                        <div>
                            <h4 style="margin: 0 0 5px 0;">${appointment.type.charAt(0).toUpperCase() + appointment.type.slice(1)} Consultation</h4>
                            <p style="margin: 0 0 5px 0; color: #666;">Doctor: ${appointment.doctor}</p>
                            <p style="margin: 0; color: #666;">Date: ${appointment.date} at ${appointment.time}</p>
                        </div>
                        <div style="padding: 5px 15px; background: #28a745; color: white; border-radius: 15px; font-size: 0.9rem;">
                            ${appointment.status}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Education functionality
        function switchCategory(category) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            
            // Update content
            document.querySelectorAll('.category-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(category).classList.add('active');
        }

        function openArticle(articleId) {
            // Mock article opening - could be expanded to show full articles
            alert(`Opening article: ${articleId}. This would typically open a detailed article view.`);
        }

        // Set minimum date for appointment booking
        function setMinDate() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const dateInput = document.getElementById('appointmentDate');
            if (dateInput) {
                dateInput.min = tomorrow.toISOString().split('T')[0];
            }
        }

        // Initialize all new sections when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            initializeTreatmentPlan();
            loadAppointmentHistory();
            setMinDate();
        });

        // Also initialize if DOM already loaded
        if (document.readyState !== 'loading') {
            initializeDashboard();
            initializeTreatmentPlan();
            loadAppointmentHistory();
            setMinDate();
        }
    </script>
</body>
</html>
